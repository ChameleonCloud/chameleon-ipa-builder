#!/bin/bash
set -eu
set -o pipefail

# This needs to match the VIRTUALENV used in the IPA element:
# https://opendev.org/openstack/ironic-python-agent-builder/src/branch/master/dib/ironic-python-agent-ramdisk/install.d/ironic-python-agent-ramdisk-source-install/60-ironic-python-agent-ramdisk-install
VIRTUALENV=/opt/ironic-python-agent
HWM_REPO=https://github.com/ChameleonCloud/chameleon-ipa-hardware-manager
HWM_REF=master

source "$VIRTUALENV/bin/activate"

case "${1:-install}" in
  install)
    pip install "git+$HWM_REPO@$HWM_REF#egg=chameleon_hardware_manager"
    ;;
  uninstall)
    pip uninstall chameleon_hardware_manager
    ;;
  *)
    echo "Invalid operation '$1'"
    exit 1
    ;;
esac
